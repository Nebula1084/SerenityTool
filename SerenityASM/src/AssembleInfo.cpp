//
//  AssembleInfo.cpp
//  Assembler
//
//  Created by scn3 on 15/10/17.
//  Copyright © 2015年 scn3. All rights reserved.
//

#include "AssembleInfo.hpp"

AssembleInfo::AssembleInfo(){
    // opcode
    // SpcIns
    opcode["eret"] = (0x00000010<<26) | (0X00000010<<21) |(0X00000018);
    opcode["mul"] =	(0x0000001C<<26) | (0X00000002);
    opcode["mfc0"] = 0x00000010<<26;  // 协处理器号为0
    opcode["mtc0"] = (0x00000010<<26) | (0X00000004<<21);
//    opcode["mfc1"] = 0x00000011<<26;
//    opcode["mtc1"] = (0x00000011<<26) | (0X00000004<<21);
    
    // ImmIns
    opcode["addi"]		=	0x00000008<<26;
    opcode["addiu"]		=	0x00000009<<26;
    opcode["slti"]		=	0x0000000A<<26;
    opcode["sltiu"]		=	0x0000000B<<26;
    opcode["andi"]		=	0x0000000C<<26;
    opcode["ori"]		=	0x0000000D<<26;
    opcode["xori"]		=	0x0000000E<<26;
    opcode["lui"]		=	0x0000000F<<26;
    
    // LoadSaveIns
    opcode["lb"]		=	0x00000020<<26;
    opcode["lh"]		=	0x00000021<<26;
    opcode["lw"]		=	0x00000023<<26;
    opcode["lbu"]		=	0x00000024<<26;
    opcode["lhu"]		=	0x00000025<<26;
    opcode["sb"]		=	0x00000028<<26;
    opcode["sh"]		=	0x00000029<<26;
    opcode["sw"]		=	0x0000002B<<26;
    
    // JumpIns
    opcode["j"]			=	0x00000002<<26;
    opcode["jal"]		=	0x00000003<<26;
    opcode["beq"]		=	0x00000004<<26;
    opcode["bne"]		=	0x00000005<<26;
    opcode["bltz"]		=	0x0000000E<<26;
    opcode["bgtz"]		=	0x00000007<<26;
    opcode["blez"]		=	0x00000006<<26;
    opcode["bgez"]		=	0x00000001<<26;
    opcode["blezal"]	=	(0x00000001<<26) | (0X00000011<<16);
    opcode["bgezal"]	=	(0x00000001<<26) | (0X00000010<<16);
    
    // RegIns
    opcode["syscall"]   =0x0000000C;
    opcode["jr"]		=0x00000008;
    opcode["mthi"]      =0x00000011;
    opcode["mtlo"]      =0x00000013;
    opcode["mfhi"]      =0x00000010;
    opcode["mflo"]      =0x00000012;
    opcode["jalr"]		=0x00000009;
    opcode["mult"]		=0x00000018;
    opcode["multu"]		=0x00000019;
    opcode["div"]		=0x0000001A;
    opcode["divu"]		=0x0000001B;
    opcode["sra"]		=0x00000003;
    opcode["sll"]		=0x00000000;
    opcode["sllv"]		=0x00000004;
    opcode["srav"]		=0x00000007;
    opcode["srl"]		=0x00000002;
    opcode["srlv"]		=0x00000006;
    
    opcode["add"]		=0x00000020;
    opcode["addu"]		=0x00000021;
    opcode["sub"]		=0x00000022;
    opcode["subu"]		=0x00000023;
    opcode["slt"]		=0x0000002A;
    opcode["sltu"]		=0x0000002B;
    opcode["and"]		=0x00000024;
    opcode["nor"]		=0x00000027;
    opcode["or"]		=0x00000025;
    opcode["xor"]		=0x00000026;
//    opcode["break"]		=0x018C630D;
    
    // 寄存器编码
    reg["$zero"]	= 0;
    reg["$at"] = 1;
    reg["$v0"] = 2;
    reg["$v1"] = 3;
    reg["$a0"] = 4;
    reg["$a1"] = 5;
    reg["$a2"] = 6;
    reg["$a3"] = 7;
    reg["$t0"] = 8;
    reg["$t1"] = 9;
    reg["$t2"] = 10;
    reg["$t3"] = 11;
    reg["$t4"] = 12;
    reg["$t5"] = 13;
    reg["$t6"] = 14;
    reg["$t7"] = 15;
    reg["$s0"] = 16;
    reg["$s1"] = 17;
    reg["$s2"] = 18;
    reg["$s3"] = 19;
    reg["$s4"] = 20;
    reg["$s5"] = 21;
    reg["$s6"] = 22;
    reg["$s7"] = 23;
    reg["$t8"] = 24;
    reg["$t9"] = 25;
    reg["$k0"] = 26;
    reg["$k1"] = 27;
    reg["$gp"] = 28;
    reg["$sp"] = 29;
    reg["$fp"] = 30;
    reg["$ra"] = 31;
    
    // 协寄存器编码
    coreg["$c0"] = 0;
    coreg["$c1"] = 1;
    coreg["$c2"] = 2;
    coreg["$c3"] = 3;
    coreg["$c4"] = 4;
    coreg["$c5"] = 5;
    coreg["$c6"] = 6;
    coreg["$c7"] = 7;
    coreg["$c8"] = 8;
    coreg["$c9"] = 9;
    coreg["$c10"] = 10;
    coreg["$c11"] = 11;
    coreg["$c12"] = 12;
    coreg["$c13"] = 13;
    coreg["$c14"] = 14;
    coreg["$c15"] = 15;
    coreg["$c16"] = 16;
    coreg["$c17"] = 17;
    coreg["$c18"] = 18;
    coreg["$c19"] = 19;
    coreg["$c20"] = 20;
    coreg["$c21"] = 21;
    coreg["$c22"] = 22;
    coreg["$c23"] = 23;
    coreg["$c24"] = 24;
    coreg["$c25"] = 25;
    coreg["$c26"] = 26;
    coreg["$c27"] = 27;
    coreg["$c28"] = 28;
    coreg["$c29"] = 29;
    coreg["$c30"] = 30;
    coreg["$c31"] = 31;
    coreg["c32"] = 32;
    
    /*
    //rd
    InsRegList["add"]	["RD"]	=true;
    InsRegList["addu"]	["RD"]	=true;
    InsRegList["and"]	["RD"]	=true;
    InsRegList["break"]	["RD"]	=false;
    InsRegList["div"]	["RD"]	=false;
    InsRegList["divu"]	["RD"]	=false;
    InsRegList["jalr"]	["RD"]	=true;
    InsRegList["jr"]	["RD"]	=false;
    InsRegList["mfhi"]	["RD"]	=true;
    InsRegList["mflo"]	["RD"]	=true;
    InsRegList["mthi"]	["RD"]	=false;
    InsRegList["mtlo"]	["RD"]	=false;
    InsRegList["mult"]	["RD"]	=false;
    InsRegList["multu"]	["RD"]	=false;
    InsRegList["nor"]	["RD"]	=true;
    InsRegList["or"]	["RD"]	=true;
    InsRegList["sll"]	["RD"]	=true;
    InsRegList["sllv"]	["RD"]	=true;
    InsRegList["slt"]	["RD"]	=true;
    InsRegList["sltu"]	["RD"]	=true;
    InsRegList["sra"]	["RD"]	=true;
    InsRegList["srav"]	["RD"]	=true;
    InsRegList["srl"]	["RD"]	=true;
    InsRegList["srlv"]	["RD"]	=true;
    InsRegList["sub"]	["RD"]	=true;
    InsRegList["subu"]	["RD"]	=true;
    InsRegList["syscall"]	["RD"]	=false;
    InsRegList["xor"]	["RD"]	=true;
    InsRegList["bgez"]	["RD"]	=false;
    InsRegList["bgezal"]	["RD"]	=false;
    InsRegList["bltz"]	["RD"]	=false;
    InsRegList["bltzal"]	["RD"]	=false;
    InsRegList["j"]	["RD"]	=false;
    InsRegList["jal"]	["RD"]	=false;
    InsRegList["beq"]	["RD"]	=false;
    InsRegList["bne"]	["RD"]	=false;
    InsRegList["blez"]	["RD"]	=false;
    InsRegList["bgtz"]	["RD"]	=false;
    InsRegList["addi"]	["RD"]	=false;
    InsRegList["addiu"]	["RD"]	=false;
    InsRegList["slti"]	["RD"]	=false;
    InsRegList["sltiu"]	["RD"]	=false;
    InsRegList["andi"]	["RD"]	=false;
    InsRegList["ori"]	["RD"]	=false;
    InsRegList["xori"]	["RD"]	=false;
    InsRegList["lui"]	["RD"]	=false;
    InsRegList["eret"]	["RD"]	=false;
    InsRegList["mfc0"]	["RD"]	=true;
    InsRegList["mtc0"]	["RD"]	=true;
    InsRegList["mfc1"]	["RD"]	=false;
    InsRegList["mtc1"]	["RD"]	=false;
    InsRegList["mul"]	["RD"]	=false;
    InsRegList["lb"]	["RD"]	=false;
    InsRegList["lh"]	["RD"]	=false;
    InsRegList["lw"]	["RD"]	=false;
    InsRegList["lbu"]	["RD"]	=false;
    InsRegList["lhu"]	["RD"]	=false;
    InsRegList["sb"]	["RD"]	=false;
    InsRegList["sh"]	["RD"]	=false;
    InsRegList["sw"]	["RD"]	=false;
    
    //rs
    InsRegList["add"]	["RS"]	=true;
    InsRegList["addu"]	["RS"]	=true;
    InsRegList["and"]	["RS"]	=true;
    InsRegList["break"]	["RS"]	=false;
    InsRegList["div"]	["RS"]	=true;
    InsRegList["divu"]	["RS"]	=true;
    InsRegList["jalr"]	["RS"]	=true;
    InsRegList["jr"]	["RS"]	=true;
    InsRegList["mfhi"]	["RS"]	=false;
    InsRegList["mflo"]	["RS"]	=false;
    InsRegList["mthi"]	["RS"]	=true;
    InsRegList["mtlo"]	["RS"]	=true;
    InsRegList["mult"]	["RS"]	=true;
    InsRegList["multu"]	["RS"]	=true;
    InsRegList["nor"]	["RS"]	=true;
    InsRegList["or"]	["RS"]	=true;
    InsRegList["sll"]	["RS"]	=false;
    InsRegList["sllv"]	["RS"]	=true;
    InsRegList["slt"]	["RS"]	=true;
    InsRegList["sltu"]	["RS"]	=true;
    InsRegList["sra"]	["RS"]	=false;
    InsRegList["srav"]	["RS"]	=true;
    InsRegList["srl"]	["RS"]	=false;
    InsRegList["srlv"]	["RS"]	=true;
    InsRegList["sub"]	["RS"]	=true;
    InsRegList["subu"]	["RS"]	=true;
    InsRegList["syscall"]	["RS"]	=false;
    InsRegList["xor"]	["RS"]	=true;
    InsRegList["bgez"]	["RS"]	=true;
    InsRegList["bgezal"]	["RS"]	=true;
    InsRegList["bltz"]	["RS"]	=true;
    InsRegList["bltzal"]	["RS"]	=true;
    InsRegList["j"]	["RS"]	=false;
    InsRegList["jal"]	["RS"]	=false;
    InsRegList["beq"]	["RS"]	=true;
    InsRegList["bne"]	["RS"]	=true;
    InsRegList["blez"]	["RS"]	=true;
    InsRegList["bgtz"]	["RS"]	=true;
    InsRegList["addi"]	["RS"]	=true;
    InsRegList["addiu"]	["RS"]	=true;
    InsRegList["slti"]	["RS"]	=true;
    InsRegList["sltiu"]	["RS"]	=true;
    InsRegList["andi"]	["RS"]	=true;
    InsRegList["ori"]	["RS"]	=true;
    InsRegList["xori"]	["RS"]	=true;
    InsRegList["lui"]	["RS"]	=false;
    InsRegList["eret"]	["RS"]	=false;
    InsRegList["mfc0"]	["RS"]	=false;
    InsRegList["mtc0"]	["RS"]	=false;
    InsRegList["mfc1"]	["RS"]	=false;
    InsRegList["mtc1"]	["RS"]	=false;
    InsRegList["mul"]	["RS"]	=true;
    InsRegList["lb"]	["RS"]	=true;
    InsRegList["lh"]	["RS"]	=true;
    InsRegList["lw"]	["RS"]	=true;
    InsRegList["lbu"]	["RS"]	=true;
    InsRegList["lhu"]	["RS"]	=true;
    InsRegList["sb"]	["RS"]	=true;
    InsRegList["sh"]	["RS"]	=true;
    InsRegList["sw"]	["RS"]	=true;
    
    //rt
    InsRegList["add"]	["RT"]	=true;
    InsRegList["addu"]	["RT"]	=true;
    InsRegList["and"]	["RT"]	=true;
    InsRegList["break"]	["RT"]	=false;
    InsRegList["div"]	["RT"]	=true;
    InsRegList["divu"]	["RT"]	=true;
    InsRegList["jalr"]	["RT"]	=false;
    InsRegList["jr"]	["RT"]	=false;
    InsRegList["mfhi"]	["RT"]	=false;
    InsRegList["mflo"]	["RT"]	=false;
    InsRegList["mthi"]	["RT"]	=false;
    InsRegList["mtlo"]	["RT"]	=false;
    InsRegList["mult"]	["RT"]	=true;
    InsRegList["multu"]	["RT"]	=true;
    InsRegList["nor"]	["RT"]	=true;
    InsRegList["or"]	["RT"]	=true;
    InsRegList["sll"]	["RT"]	=true;
    InsRegList["sllv"]	["RT"]	=true;
    InsRegList["slt"]	["RT"]	=true;
    InsRegList["sltu"]	["RT"]	=true;
    InsRegList["sra"]	["RT"]	=true;
    InsRegList["srav"]	["RT"]	=true;
    InsRegList["srl"]	["RT"]	=true;
    InsRegList["srlv"]	["RT"]	=true;
    InsRegList["sub"]	["RT"]	=true;
    InsRegList["subu"]	["RT"]	=true;
    InsRegList["syscall"]	["RT"]	=false;
    InsRegList["xor"]	["RT"]	=true;
    InsRegList["bgez"]	["RT"]	=false;
    InsRegList["bgezal"]	["RT"]	=false;
    InsRegList["bltz"]	["RT"]	=false;
    InsRegList["bltzal"]	["RT"]	=false;
    InsRegList["j"]	["RT"]	=false;
    InsRegList["jal"]	["RT"]	=false;
    InsRegList["beq"]	["RT"]	=true;
    InsRegList["bne"]	["RT"]	=true;
    InsRegList["blez"]	["RT"]	=false;
    InsRegList["bgtz"]	["RT"]	=false;
    InsRegList["addi"]	["RT"]	=true;
    InsRegList["addiu"]	["RT"]	=true;
    InsRegList["slti"]	["RT"]	=true;
    InsRegList["sltiu"]	["RT"]	=true;
    InsRegList["andi"]	["RT"]	=true;
    InsRegList["ori"]	["RT"]	=true;
    InsRegList["xori"]	["RT"]	=true;
    InsRegList["lui"]	["RT"]	=true;
    InsRegList["eret"]	["RT"]	=false;
    InsRegList["mfc0"]	["RT"]	=true;
    InsRegList["mtc0"]	["RT"]	=true;
    InsRegList["mfc1"]	["RT"]	=true;
    InsRegList["mtc1"]	["RT"]	=true;
    InsRegList["mul"]	["RT"]	=true;
    InsRegList["lb"]	["RT"]	=true;
    InsRegList["lh"]	["RT"]	=true;
    InsRegList["lw"]	["RT"]	=true;
    InsRegList["lbu"]	["RT"]	=true;
    InsRegList["lhu"]	["RT"]	=true;
    InsRegList["sb"]	["RT"]	=true;
    InsRegList["sh"]	["RT"]	=true;
    InsRegList["sw"]	["RT"]	=true;
    
    //sft
    InsRegList["add"]	["SFT"]	=false;
    InsRegList["addu"]	["SFT"]	=false;
    InsRegList["and"]	["SFT"]	=false;
    InsRegList["break"]	["SFT"]	=false;
    InsRegList["div"]	["SFT"]	=false;
    InsRegList["divu"]	["SFT"]	=false;
    InsRegList["jalr"]	["SFT"]	=false;
    InsRegList["jr"]	["SFT"]	=false;
    InsRegList["mfhi"]	["SFT"]	=false;
    InsRegList["mflo"]	["SFT"]	=false;
    InsRegList["mthi"]	["SFT"]	=false;
    InsRegList["mtlo"]	["SFT"]	=false;
    InsRegList["mult"]	["SFT"]	=false;
    InsRegList["multu"]	["SFT"]	=false;
    InsRegList["nor"]	["SFT"]	=false;
    InsRegList["or"]	["SFT"]	=false;
    InsRegList["sll"]	["SFT"]	=true;
    InsRegList["sllv"]	["SFT"]	=false;
    InsRegList["slt"]	["SFT"]	=false;
    InsRegList["sltu"]	["SFT"]	=false;
    InsRegList["sra"]	["SFT"]	=true;
    InsRegList["srav"]	["SFT"]	=false;
    InsRegList["srl"]	["SFT"]	=true;
    InsRegList["srlv"]	["SFT"]	=false;
    InsRegList["sub"]	["SFT"]	=false;
    InsRegList["subu"]	["SFT"]	=false;
    InsRegList["syscall"]	["SFT"]	=false;
    InsRegList["xor"]	["SFT"]	=false;
    InsRegList["bgez"]	["SFT"]	=false;
    InsRegList["bgezal"]	["SFT"]	=false;
    InsRegList["bltz"]	["SFT"]	=false;
    InsRegList["bltzal"]	["SFT"]	=false;
    InsRegList["j"]	["SFT"]	=false;
    InsRegList["jal"]	["SFT"]	=false;
    InsRegList["beq"]	["SFT"]	=false;
    InsRegList["bne"]	["SFT"]	=false;
    InsRegList["blez"]	["SFT"]	=false;
    InsRegList["bgtz"]	["SFT"]	=false;
    InsRegList["addi"]	["SFT"]	=false;
    InsRegList["addiu"]	["SFT"]	=false;
    InsRegList["slti"]	["SFT"]	=false;
    InsRegList["sltiu"]	["SFT"]	=false;
    InsRegList["andi"]	["SFT"]	=false;
    InsRegList["ori"]	["SFT"]	=false;
    InsRegList["xori"]	["SFT"]	=false;
    InsRegList["lui"]	["SFT"]	=false;
    InsRegList["eret"]	["SFT"]	=false;
    InsRegList["mfc0"]	["SFT"]	=false;
    InsRegList["mtc0"]	["SFT"]	=false;
    InsRegList["mfc1"]	["SFT"]	=false;
    InsRegList["mtc1"]	["SFT"]	=false;
    InsRegList["mul"]	["SFT"]	=false;
    InsRegList["lb"]	["SFT"]	=false;
    InsRegList["lh"]	["SFT"]	=false;
    InsRegList["lw"]	["SFT"]	=false;
    InsRegList["lbu"]	["SFT"]	=false;
    InsRegList["lhu"]	["SFT"]	=false;
    InsRegList["sb"]	["SFT"]	=false;
    InsRegList["sh"]	["SFT"]	=false;
    InsRegList["sw"]	["SFT"]	=false;
    */
    //insType
    insType["move"] = PseudoIns;
    insType["not"] = PseudoIns;
    insType["neg"] = PseudoIns;
    insType["push"] = PseudoIns;
    insType["pop"] = PseudoIns;
    insType["blt"] = PseudoIns;
    insType["bgt"] = PseudoIns;
    insType["ble"] = PseudoIns;
    insType["bge"] = PseudoIns;
    insType["abs"] = PseudoIns;
    insType["swap"] = PseudoIns;
    insType["sne"] = PseudoIns;
    insType["seq"] = PseudoIns;
    insType["li"] = PseudoIns;
    insType["la"] = PseudoIns;
    
    insType["eret"]	= SpcIns;
    insType["mul"]	= SpcIns;
    insType["mfc0"]	=SpcIns;
    insType["mtc0"]	=SpcIns;
//    insType["mfc1"]	=SpcIns;
//    insType["mtc1"]	=SpcIns;
    
    insType["addi"]	= ImmIns;
    insType["addiu"] = ImmIns;
    insType["slti"]	= ImmIns;
    insType["sltiu"] = ImmIns;
    insType["andi"]	= ImmIns;
    insType["ori"] = ImmIns;
    insType["xori"]	= ImmIns;
    insType["lui"] = ImmIns;
    
    insType["lb"] = LoadSaveIns;
    insType["lh"] = LoadSaveIns;
    insType["lw"] = LoadSaveIns;
    insType["lbu"] = LoadSaveIns;
    insType["lhu"] = LoadSaveIns;
    insType["sb"] = LoadSaveIns;
    insType["sh"] = LoadSaveIns;
    insType["sw"] = LoadSaveIns;
    
    insType["j"] = JumpIns;
    insType["jal"] = JumpIns;
    insType["beq"] = JumpIns;
    insType["bne"] = JumpIns;
    insType["bltz"]	= JumpIns;
    insType["bgtz"]	= JumpIns;
    insType["blez"]	= JumpIns;
    insType["bgez"]	= JumpIns;
    insType["blezal"] = JumpIns;
    insType["bgezal"] = JumpIns;

    insType["add"] = RegIns;
    insType["addu"]	= RegIns;
    insType["sub"] = RegIns;
    insType["subu"] = RegIns;
    insType["slt"] = RegIns;
    insType["sltu"]	= RegIns;
    insType["mult"]	= RegIns;
    insType["multu"] = RegIns;
    insType["div"] = RegIns;
    insType["divu"]	= RegIns;
    insType["mfhi"]	= RegIns;
    insType["mflo"]	= RegIns;
    insType["mthi"]	= RegIns;
    insType["mtlo"]	= RegIns;
    insType["and"] = RegIns;
    insType["nor"] = RegIns;
    insType["or"] = RegIns;
    insType["xor"] = RegIns;
    insType["sll"] = RegIns;
    insType["sllv"]	= RegIns;
    insType["sra"] = RegIns;
    insType["srav"]	= RegIns;
    insType["srl"] = RegIns;
    insType["srlv"]	= RegIns;
    insType["jr"] = RegIns;
    insType["jalr"]	= RegIns;
    insType["syscall"] = RegIns;
//    insType["break"] = RegIns;
    
    insType[".origin"] = FormatIns;
    insType[".asciiz"] = FormatIns;
    insType[".2byte"] = FormatIns;
}
